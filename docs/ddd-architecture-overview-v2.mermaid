graph TB
    %% ==========================================
    %% æ•´ä½“æ¶æ„è§†å›¾ v2.0 - åŸºäºå®é™…ä»£ç å®ç°
    %% ==========================================

    subgraph External["ğŸŒ å¤–éƒ¨ä¸–ç•Œ"]
        HTTP["HTTPè¯·æ±‚<br/>POST /api/users/register<br/>GET /api/users/{id}"]
        MQ["æ¶ˆæ¯é˜Ÿåˆ—<br/>OrderCreatedEvent<br/>(é¢„ç•™æ‰©å±•)"]
        Schedule["å®šæ—¶ä»»åŠ¡<br/>OrderSyncJob<br/>(é¢„ç•™æ‰©å±•)"]
    end

    %% ==========================================
    %% user-start æ¨¡å—
    %% ==========================================
    subgraph StartModule["ğŸš€ user-start æ¨¡å—"]
        style StartModule fill:#e0f2f1,stroke:#00695c,stroke-width:2px

        StartApp["UserApplication.java<br/>â”â”â”â”â”â”â”<br/>@SpringBootApplication<br/>+ main(args)"]

        StartCfg["application.yml<br/>â”â”â”â”â”â”â”<br/>server.port: 8080<br/>spring.datasource.url: jdbc:h2:mem:user_db"]
    end

    %% ==========================================
    %% Adapter Layer (é€‚é…å±‚)
    %% ==========================================
    subgraph Layer1["ğŸ“± Adapter Layer - é€‚é…å±‚"]
        direction LR
        style Layer1 fill:#e1f5ff,stroke:#01579b,stroke-width:3px

        subgraph AdapterBox["èŒè´£: åè®®è½¬æ¢ & å‚æ•°æ ¡éªŒ"]
            Controller["UserController<br/>â”â”â”â”â”â”â”<br/>ğŸ“ adapter/web/UserController.java<br/>â”â”â”â”â”â”â”<br/>â€¢ register(@Valid cmd)<br/>â€¢ getById(@PathVariable id)<br/>â€¢ health()"]

            Listener["OrderEventListener<br/>â”â”â”â”â”â”â”<br/>ğŸ“ adapter/mq/EventListener.java<br/>â”â”â”â”â”â”â”<br/>â€¢ onOrderCreated()<br/>(é¢„ç•™æ‰©å±•)"]

            Job["OrderSyncJob<br/>â”â”â”â”â”â”â”<br/>ğŸ“ adapter/job/SyncJob.java<br/>â”â”â”â”â”â”â”<br/>â€¢ syncOrders()<br/>(é¢„ç•™æ‰©å±•)"]
        end

        Exception["GlobalExceptionHandler<br/>â”â”â”â”â”â”â”<br/>ğŸ“ adapter/exception/<br/>GlobalExceptionHandler.java<br/>â”â”â”â”â”â”â”<br/>â€¢ handleBizException()<br/>â€¢ handleValidationException()"]

        AdapterModule["ğŸ“¦ user-adapter æ¨¡å—<br/>â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client, user-app"]

        AdapterPrinciple["âœ… éš”ç¦»å¤–éƒ¨åè®®<br/>âœ… ç»Ÿä¸€æ¥å…¥æ ‡å‡†<br/>âœ… @Validå‚æ•°æ ¡éªŒ<br/>âœ… è–„è–„ä¸€å±‚æ— ä¸šåŠ¡é€»è¾‘"]
    end

    %% ==========================================
    %% Client API (å¯¹å¤–å¥‘çº¦)
    %% ==========================================
    subgraph ClientAPI["ğŸ“‹ Client API - å¯¹å¤–å¥‘çº¦"]
        direction TB
        style ClientAPI fill:#f3e5f5,stroke:#4a148c,stroke-width:2px

        subgraph InterfaceBox["æ¥å£å®šä¹‰"]
            ServiceI["UserServiceI<br/>â”â”â”â”â”â”â”<br/>ğŸ“ api/UserServiceI.java<br/>â”â”â”â”â”â”â”<br/>â€¢ register(cmd)<br/>â€¢ getById(qry)"]
        end

        subgraph DTOBox["æ•°æ®ä¼ è¾“å¯¹è±¡"]
            DTO["UserDTO<br/>â”â”â”â”â”â”â”<br/>ğŸ“ dto/UserDTO.java<br/>â”â”â”â”â”â”â”<br/>â€¢ id, username<br/>â€¢ email, phone(è„±æ•)<br/>â€¢ status, registerTime"]
        end

        subgraph CQRSBox["CQRSæ¨¡å¼"]
            Command["UserRegisterCmd<br/>â”â”â”â”â”â”â”<br/>ğŸ“ dto/cmd/UserRegisterCmd.java<br/>â”â”â”â”â”â”â”<br/>â€¢ username, email<br/>â€¢ password, phone<br/>â€¢ sendEmail, sendSms"]

            Query["UserByIdQry<br/>â”â”â”â”â”â”â”<br/>ğŸ“ dto/query/UserByIdQry.java<br/>â”â”â”â”â”â”â”<br/>â€¢ userId"]
        end

        subgraph ExceptionBox["å¼‚å¸¸ä½“ç³»"]
            BizExc["BizException<br/>â”â”â”â”â”â”â”<br/>ğŸ“ exception/BizException.java"]

            SysExc["SysException<br/>â”â”â”â”â”â”â”<br/>ğŸ“ exception/SysException.java"]

            ErrCode["ErrorCode<br/>â”â”â”â”â”â”â”<br/>ğŸ“ exception/ErrorCode.java<br/>â”â”â”â”â”â”â”<br/>PARAM_INVALID<br/>EMAIL_ALREADY_EXISTS<br/>USER_NOT_FOUND"]
        end

        ClientModule["ğŸ“¦ user-client æ¨¡å—<br/>â”â”â”â”â”â”â”<br/>è¢«æ‰€æœ‰å±‚ä¾èµ–"]

        ClientPrinciple["âœ… æ‰€æœ‰å±‚ä¾èµ–Client<br/>âœ… å®šä¹‰APIå¥‘çº¦<br/>âœ… DTO/Command/Queryåˆ†ç¦»"]
    end

    %% ==========================================
    %% Application Layer (åº”ç”¨å±‚)
    %% ==========================================
    subgraph Layer2["âš™ï¸ Application Layer - åº”ç”¨å±‚"]
        direction LR
        style Layer2 fill:#fff3e0,stroke:#e65100,stroke-width:3px

        subgraph AppBox["èŒè´£: æµç¨‹ç¼–æ’ & ç”¨ä¾‹å®ç°"]
            AppService["UserApplicationService<br/>â”â”â”â”â”â”â”<br/>ğŸ“ app/UserApplicationService.java<br/>â”â”â”â”â”â”â”<br/>åº”ç”¨æœåŠ¡é—¨é¢<br/>â€¢ register(cmd)<br/>â€¢ getById(qry)"]

            CmdExe["UserRegisterCmdExe<br/>â”â”â”â”â”â”â”<br/>ğŸ“ app/executor/<br/>UserRegisterCmdExe.java<br/>â”â”â”â”â”â”â”<br/>@Transactional<br/>â€¢ execute(cmd)<br/>â”â”â”â”â”â”â”<br/>1.validate() é‚®ç®±/æ‰‹æœºæ ¡éªŒ<br/>2.buildUser() æ„å»ºé¢†åŸŸå¯¹è±¡<br/>3.user.register() ä¸šåŠ¡é€»è¾‘<br/>4.save() ä¿å­˜èšåˆæ ¹<br/>5.sendNotifications() å‘é€é€šçŸ¥"]

            CmdExeExt["UserRegisterCmdExeWithExtension<br/>â”â”â”â”â”â”â”<br/>ğŸ“ app/executor/<br/>UserRegisterCmdExeWithExtension.java<br/>â”â”â”â”â”â”â”<br/>æ”¯æŒæ‰©å±•ç‚¹<br/>â€¢ execute(cmd, bizScenario)<br/>â”â”â”â”â”â”â”<br/>ä½¿ç”¨ExtensionExecutor"]

            QryExe["UserByIdQryExe<br/>â”â”â”â”â”â”â”<br/>ğŸ“ app/executor/<br/>UserByIdQryExe.java<br/>â”â”â”â”â”â”â”<br/>â€¢ execute(qry)"]

            Assembler["UserAssembler<br/>â”â”â”â”â”â”â”<br/>ğŸ“ app/assembler/<br/>UserAssembler.java<br/>â”â”â”â”â”â”â”<br/>â€¢ toDTO(user) è„±æ•è½¬æ¢<br/>â€¢ toDomain(cmd) è½¬é¢†åŸŸå¯¹è±¡<br/>â€¢ getMaskedPhone/Email() è„±æ•"]

            Transaction["ğŸ”„ äº‹åŠ¡è¾¹ç•Œ<br/>@Transactional"]
        end

        AppModule["ğŸ“¦ user-app æ¨¡å—<br/>â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client, user-domain"]

        AppPrinciple["âœ… æ— ä¸šåŠ¡é€»è¾‘<br/>âœ… ç¼–æ’Domainå¯¹è±¡<br/>âœ… æ§åˆ¶äº‹åŠ¡è¾¹ç•Œ<br/>âœ… DTOä¸Domainè½¬æ¢"]
    end

    %% ==========================================
    %% Domain Layer (é¢†åŸŸå±‚) - æ ¸å¿ƒ
    %% ==========================================
    subgraph Layer3["ğŸ’ Domain Layer - é¢†åŸŸå±‚ â­æ ¸å¿ƒâ­"]
        direction TB
        style Layer3 fill:#e8f5e9,stroke:#1b5e20,stroke-width:4px

        subgraph DomainBox["èŒè´£: ä¸šåŠ¡è§„åˆ™ & æ ¸å¿ƒé€»è¾‘"]
            subgraph AggregateBox["èšåˆ Aggregate"]
                User["User èšåˆæ ¹<br/>â”â”â”â”â”â”â”<br/>ğŸ“ domain/model/User.java<br/>â”â”â”â”â”â”â”<br/>å­—æ®µ: id, username<br/>email(Emailå€¼å¯¹è±¡)<br/>phone(Phoneå€¼å¯¹è±¡)<br/>password, status<br/>registerTime, lastActiveTime<br/>â”â”â”â”â”â”â”<br/>ä¸šåŠ¡æ–¹æ³•:<br/>â€¢ register(encryptedPwd)<br/>â€¢ activate() å†»ç»“ç”¨æˆ·ä¸èƒ½æ¿€æ´»<br/>â€¢ freeze() çŠ¶æ€=FROZEN<br/>â€¢ changeEmail(newEmail)<br/>  å†»ç»“ç”¨æˆ·ä¸èƒ½ä¿®æ”¹"]
            end

            subgraph ValueObjectBox["å€¼å¯¹è±¡ ValueObject"]
                Email["Email<br/>â”â”â”â”â”â”â”<br/>ğŸ“ domain/model/Email.java<br/>â”â”â”â”â”â”â”<br/>â€¢ EMAIL_PATTERNæ­£åˆ™æ ¡éªŒ<br/>â€¢ isValid(value) é™æ€æ ¡éªŒ<br/>â€¢ æ„é€ æ—¶è‡ªåŠ¨æ ¡éªŒæ ¼å¼"]

                Phone["Phone<br/>â”â”â”â”â”â”â”<br/>ğŸ“ domain/model/Phone.java<br/>â”â”â”â”â”â”â”<br/>â€¢ PHONE_PATTERNæ­£åˆ™æ ¡éªŒ<br/>â€¢ isValid(value) é™æ€æ ¡éªŒ<br/>â€¢ æ„é€ æ—¶è‡ªåŠ¨æ ¡éªŒæ ¼å¼"]

                Status["UserStatus<br/>â”â”â”â”â”â”â”<br/>ğŸ“ client/constant/UserStatus.java<br/>â”â”â”â”â”â”â”<br/>â€¢ INACTIVE æœªæ¿€æ´»<br/>â€¢ ACTIVE æ­£å¸¸<br/>â€¢ FROZEN å†»ç»“"]
            end

            subgraph ServiceBox["é¢†åŸŸæœåŠ¡ DomainService"]
                DomainService["UserDomainService<br/>â”â”â”â”â”â”â”<br/>ğŸ“ domain/service/<br/>UserDomainService.java<br/>â”â”â”â”â”â”â”<br/>â€¢ isEmailExists(email)<br/>â€¢ isPhoneExists(phone)<br/>â€¢ encryptPassword(pwd) BCrypt<br/>â€¢ verifyPassword(input, enc)"]
            end

            subgraph InterfaceBox["ä»“å‚¨æ¥å£ (é˜²è…å±‚)"]
                IRepository["IUserRepository<br/>â”â”â”â”â”â”â”<br/>ğŸ“ domain/gateway/<br/>IUserRepository.java<br/>â”â”â”â”â”â”â”<br/>â€¢ save(user) User<br/>â€¢ findById(id) User<br/>â€¢ findByEmail/Phone/Username()<br/>â€¢ update(user) User<br/>â€¢ delete(id)"]

                IEmail["IEmailGateway<br/>â”â”â”â”â”â”â”<br/>ğŸ“ domain/gateway/<br/>IEmailGateway.java<br/>â”â”â”â”â”â”â”<br/>â€¢ sendWelcomeEmail(to, username)<br/>â€¢ sendVerifyEmail(to, code)"]

                ISms["ISmsGateway<br/>â”â”â”â”â”â”â”<br/>ğŸ“ domain/gateway/<br/>ISmsGateway.java<br/>â”â”â”â”â”â”â”<br/>â€¢ sendRegisterSms(to, username)<br/>â€¢ sendVerifyCode(to, code)"]
            end

            subgraph ExtensionBox["æ‰©å±•ç‚¹æœºåˆ¶"]
                ExtPt["ExtensionPointI<br/>ğŸ“ domain/extension/<br/>ExtensionPointI.java<br/>æ‰©å±•ç‚¹æ ‡è®°æ¥å£"]

                ExtExec["ExtensionExecutor<br/>ğŸ“ domain/extension/<br/>ExtensionExecutor.java<br/>â”â”â”â”â”â”â”<br/>â€¢ execute(extPt, scenario, invoker)<br/>â€¢ executeVoid(extPt, scenario, invoker)<br/>â€¢ getExtension(extPt, scenario)"]

                ExtBiz["BizScenario<br/>ğŸ“ domain/extension/<br/>BizScenario.java<br/>â”â”â”â”â”â”â”<br/>â€¢ valueOf(bizId)<br/>â€¢ valueOf(bizId, useCase)<br/>â€¢ matches(bizId, useCase, scenario)"]

                ExtAnn["@Extension<br/>ğŸ“ domain/extension/<br/>Extension.java<br/>æ³¨è§£<br/>â”â”â”â”â”â”â”<br/>â€¢ bizId ä¸šåŠ¡èº«ä»½<br/>â€¢ useCase ç”¨ä¾‹<br/>â€¢ scenario åœºæ™¯"]

                ExtList["å·²å®ç°æ‰©å±•ç‚¹:<br/>â”â”â”â”â”â”â”<br/>â€¢ UserValidatorExtPt<br/>  ğŸ“ impl/DefaultUserValidatorExt.java<br/>  ğŸ“ impl/VipUserValidatorExt.java<br/>â€¢ UserRegisterBonusExtPt<br/>  ğŸ“ impl/DefaultUserRegisterBonusExt.java<br/>  ğŸ“ impl/VipUserRegisterBonusExt.java<br/>â€¢ LevelUpgradeExtPt<br/>  ğŸ“ impl/NormalUserLevelUpgradeExt.java<br/>  ğŸ“ impl/VipUserLevelUpgradeExt.java<br/>  ğŸ“ impl/EnterpriseUserLevelUpgradeExt.java<br/>â€¢ RiskCheckExtPt<br/>  ğŸ“ impl/*RiskCheckExt.java<br/>â€¢ PointCalculateExtPt<br/>  ğŸ“ impl/*PointExt.java<br/>â€¢ NotificationChannelExtPt<br/>  ğŸ“ impl/*NotificationChannelExt.java<br/>â€¢ OrderDiscountExtPt<br/>  ğŸ“ impl/*OrderDiscountExt.java<br/>â€¢ RegisterValidatorExtPt<br/>  ğŸ“ impl/*RegisterValidatorExt.java"]
            end
        end

        DomainModule["ğŸ“¦ user-domain æ¨¡å—<br/>â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client"]

        DomainPrinciple["âœ… æ‰€æœ‰ä¸šåŠ¡è§„åˆ™åœ¨æ­¤<br/>âœ… å……è¡€æ¨¡å‹<br/>âœ… å®Œå…¨æŠ€æœ¯æ— å…³<br/>âœ… å®šä¹‰æ¥å£ä¸ä¾èµ–å®ç°<br/>âœ… æ”¯æŒæ‰©å±•ç‚¹æœºåˆ¶"]
    end

    %% ==========================================
    %% Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)
    %% ==========================================
    subgraph Layer4["ğŸ”§ Infrastructure Layer - åŸºç¡€è®¾æ–½å±‚"]
        direction LR
        style Layer4 fill:#fce4ec,stroke:#880e4f,stroke-width:3px

        subgraph InfraBox["èŒè´£: æŠ€æœ¯å®ç° & å¤–éƒ¨é›†æˆ"]
            direction TB

            subgraph DBBox["æ•°æ®æŒä¹…åŒ–"]
                RepoImpl["UserRepositoryImpl<br/>â”â”â”â”â”â”â”<br/>ğŸ“ infrastructure/gatewayimpl/<br/>UserRepositoryImpl.java<br/>â”â”â”â”â”â”â”<br/>å®ç° IUserRepository<br/>â€¢ save(user) æ’å…¥å¹¶è¿”å›ID<br/>â€¢ findById(id) æŸ¥è¯¢<br/>â€¢ findByEmail/Phone/Username()<br/>â€¢ ä½¿ç”¨LambdaQueryWrapper"]

                Converter["UserConverter<br/>â”â”â”â”â”â”â”<br/>ğŸ“ infrastructure/converter/<br/>UserConverter.java<br/>â”â”â”â”â”â”â”<br/>â€¢ toDataObject(user) UserPO<br/>â€¢ toDomain(po) User<br/>â”â”â”â”â”â”â”<br/>å¤„ç†Email/Phoneå€¼å¯¹è±¡è½¬æ¢"]

                Mapper["UserMapper<br/>â”â”â”â”â”â”â”<br/>ğŸ“ infrastructure/mapper/<br/>UserMapper.java<br/>â”â”â”â”â”â”â”<br/>MyBatis Mapper<br/>â€¢ insert(po)<br/>â€¢ selectById(id)<br/>â€¢ updateById(po)"]

                DB[("ğŸ’¾ H2 Database<br/>â”â”â”â”â”â”â”<br/>userè¡¨<br/>å¼€å‘ç¯å¢ƒå†…å­˜æ•°æ®åº“")]
            end

            subgraph GatewayBox["ç½‘å…³å®ç° (é˜²è…å±‚)"]
                EmailGW["EmailGatewayImpl<br/>â”â”â”â”â”â”â”<br/>ğŸ“ infrastructure/gatewayimpl/<br/>EmailGatewayImpl.java<br/>â”â”â”â”â”â”â”<br/>å®ç° IEmailGateway<br/>â€¢ sendWelcomeEmail() æ—¥å¿—è®°å½•<br/>â€¢ è¿”å›trueæ¨¡æ‹Ÿå‘é€"]

                SmsGW["SmsGatewayImpl<br/>â”â”â”â”â”â”â”<br/>ğŸ“ infrastructure/gatewayimpl/<br/>SmsGatewayImpl.java<br/>â”â”â”â”â”â”â”<br/>å®ç° ISmsGateway<br/>â€¢ sendRegisterSms() æ—¥å¿—è®°å½•<br/>â€¢ è¿”å›trueæ¨¡æ‹Ÿå‘é€"]
            end

            subgraph ThirdPartyBox["ç¬¬ä¸‰æ–¹é›†æˆ(é¢„ç•™)"]
                EmailService["ğŸ“§ ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡<br/>(å®é™…é¡¹ç›®å¯¹æ¥)<br/>SendGrid/é˜¿é‡Œäº‘/è…¾è®¯äº‘"]

                SMSService["ğŸ“± ç¬¬ä¸‰æ–¹çŸ­ä¿¡æœåŠ¡<br/>(å®é™…é¡¹ç›®å¯¹æ¥)<br/>é˜¿é‡Œäº‘/è…¾è®¯äº‘"]
            end
        end

        InfraModule["ğŸ“¦ user-infrastructure æ¨¡å—<br/>â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client, user-domain"]

        InfraPrinciple["âœ… å®ç°Domainæ¥å£<br/>âœ… ä¾èµ–å€’ç½®åŸåˆ™<br/>âœ… å¯æ›¿æ¢æ€§<br/>âœ… é˜²è…å±‚éš”ç¦»ç¬¬ä¸‰æ–¹"]
    end

    %% ==========================================
    %% æ¨¡å—ä¾èµ–å…³ç³»
    %% ==========================================
    subgraph ModuleDeps["ğŸ“¦ Maven æ¨¡å—ä¾èµ–å…³ç³»"]
        style ModuleDeps fill:#f5f5f5,stroke:#424242,stroke-width:2px

        MStart["user-start<br/>â”â”â”â”â”â”â”<br/>å¯åŠ¨æ¨¡å—"]
        MAdapter["user-adapter<br/>â”â”â”â”â”â”â”<br/>é€‚é…å±‚"]
        MApp["user-app<br/>â”â”â”â”â”â”â”<br/>åº”ç”¨å±‚"]
        MDomain["user-domain<br/>â”â”â”â”â”â”â”<br/>é¢†åŸŸå±‚"]
        MInfra["user-infrastructure<br/>â”â”â”â”â”â”â”<br/>åŸºç¡€è®¾æ–½å±‚"]
        MClient["user-client<br/>â”â”â”â”â”â”â”<br/>å¯¹å¤–å¥‘çº¦"]

        MStart --> MAdapter
        MAdapter --> MApp
        MApp --> MDomain
        MApp --> MInfra
        MInfra --> MClient
        MDomain --> MClient
        MAdapter --> MClient
        MApp --> MClient
    end

    %% ==========================================
    %% æ•°æ®æµè½¬ (è¯·æ±‚å¤„ç†å…¨æµç¨‹)
    %% ==========================================
    HTTP -->|1ï¸âƒ£ HTTPè¯·æ±‚| Controller
    MQ -->|1ï¸âƒ£ MQæ¶ˆæ¯| Listener
    Schedule -->|1ï¸âƒ£ å®šæ—¶è§¦å‘| Job

    Controller -->|2ï¸âƒ£ è°ƒç”¨æœåŠ¡<br/>ä¼ å…¥@Validå‚æ•°| AppService
    Listener -->|2ï¸âƒ£ è°ƒç”¨æœåŠ¡| AppService
    Job -->|2ï¸âƒ£ è°ƒç”¨æœåŠ¡| AppService

    AppService -->|3ï¸âƒ£ å§”æ‰˜æ‰§è¡Œ| CmdExe
    AppService -->|3ï¸âƒ£ å§”æ‰˜æ‰§è¡Œ| QryExe

    CmdExe -->|4ï¸âƒ£ ä½¿ç”¨| Assembler
    CmdExe -->|4ï¸âƒ£ è°ƒç”¨ä¸šåŠ¡è§„åˆ™| User
    CmdExe -->|4ï¸âƒ£ è°ƒç”¨é¢†åŸŸæœåŠ¡| DomainService
    CmdExe -->|5ï¸âƒ£ ä¾èµ–æ¥å£| IRepository
    CmdExe -->|5ï¸âƒ£ ä¾èµ–æ¥å£| IEmail
    CmdExe -->|5ï¸âƒ£ ä¾èµ–æ¥å£| ISms

    CmdExeExt -->|4ï¸âƒ£ ä½¿ç”¨æ‰©å±•ç‚¹| ExtExec
    ExtExec -->|5ï¸âƒ£ æŸ¥æ‰¾æ‰©å±•ç‚¹å®ç°| ExtBiz

    QryExe -->|4ï¸âƒ£ ä½¿ç”¨| Assembler
    QryExe -->|4ï¸âƒ£ ä¾èµ–æ¥å£| IRepository

    DomainService -->|ä¾èµ–æ¥å£| IRepository

    %% Infrastructureå®ç°æ¥å£ (ä¾èµ–å€’ç½®!)
    IRepository <-.->|6ï¸âƒ£ å®ç°| RepoImpl
    IEmail <-.->|6ï¸âƒ£ å®ç°| EmailGW
    ISms <-.->|6ï¸âƒ£ å®ç°| SmsGW

    RepoImpl -->|7ï¸âƒ£ æ•°æ®è®¿é—®| Mapper
    Mapper -->|æ“ä½œ| DB
    RepoImpl -->|è½¬æ¢| Converter

    EmailGW -.->|è°ƒç”¨| EmailService
    SmsGW -.->|è°ƒç”¨| SMSService

    %% DTOä½¿ç”¨å…³ç³»
    Controller -.->|ä½¿ç”¨| Command
    Controller -.->|è¿”å›| DTO
    AppService -.->|è¿”å›| DTO
    QryExe -.->|è½¬æ¢| DTO

    %% å¼‚å¸¸å¤„ç†
    Controller -.->|æŠ›å‡º| BizExc
    Exception -->|æ•è·| BizExc
    Exception -->|æ•è·| SysExc
    BizExc -->|ä½¿ç”¨| ErrCode

    %% ==========================================
    %% æ‰©å±•ç‚¹ä½¿ç”¨æµç¨‹
    %% ==========================================
    subgraph ExtensionFlow["ğŸ”Œ æ‰©å±•ç‚¹ä½¿ç”¨æµç¨‹ç¤ºä¾‹"]
        direction LR
        style ExtensionFlow fill:#e1bee7,stroke:#4a148c,stroke-width:2px

        App["Application"] -->|1.ä¼ å…¥åœºæ™¯| Exec["ExtensionExecutor"]
        Exec -->|2.æŸ¥æ‰¾åŒ¹é…| Default["Defaultå®ç°<br/>@Extension bizId=DEFAULT<br/>ğŸ“ impl/Default*Ext.java"]
        Exec -->|2.æŸ¥æ‰¾åŒ¹é…| VIP["VIPå®ç°<br/>@Extension bizId=VIP<br/>ğŸ“ impl/Vip*Ext.java"]
        Exec -->|3.æ‰§è¡Œ| ExtLogic["æ‰©å±•ç‚¹é€»è¾‘"]

        ExtFlow -.->|å…œåº•| Default
    end

    %% ==========================================
    %% æ ·å¼å®šä¹‰
    %% ==========================================
    classDef externalStyle fill:#e0e0e0,stroke:#424242,stroke-width:2px
    classDef extensionStyle fill:#fff8e1,stroke:#ff6f00,stroke-width:2px
    classDef moduleStyle fill:#f5f5f5,stroke:#616161,stroke-width:2px

    class HTTP,MQ,Schedule externalStyle
    class ExtExec,ExtBiz,ExtAnn extensionStyle
    class AdapterModule,ClientModule,AppModule,DomainModule,InfraModule,MStart,MAdapter,MApp,MDomain,MInfra,MClient moduleStyle
