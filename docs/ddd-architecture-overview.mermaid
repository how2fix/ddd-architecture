graph TB
    %% ==========================================
    %% æ•´ä½“æ¶æ„è§†å›¾ - å±•ç¤ºå±‚æ¬¡å’Œæ•°æ®æµ
    %% ==========================================
    
    subgraph External["ğŸŒ å¤–éƒ¨ä¸–ç•Œ"]
        HTTP["HTTPè¯·æ±‚<br/>GET /users/123<br/>POST /users/register"]
        MQ["æ¶ˆæ¯é˜Ÿåˆ—<br/>OrderCreatedEvent"]
        Schedule["å®šæ—¶ä»»åŠ¡<br/>æ¯å¤©å‡Œæ™¨åŒæ­¥"]
    end

    %% ==========================================
    %% ç¬¬ä¸€å±‚: Adapter (é€‚é…å±‚)
    %% ==========================================
    subgraph Layer1["ğŸ“± Adapter Layer - é€‚é…å±‚"]
        direction LR
        style Layer1 fill:#e1f5ff,stroke:#01579b,stroke-width:3px
        
        subgraph AdapterBox["èŒè´£: åè®®è½¬æ¢ & å‚æ•°æ ¡éªŒ"]
            Controller["UserController<br/>â”â”â”â”â”â”â”<br/>â€¢ register(request)<br/>â€¢ getUserById(id)<br/>â”â”â”â”â”â”â”<br/>å¤„ç†HTTPè¯·æ±‚"]
            
            Listener["OrderEventListener<br/>â”â”â”â”â”â”â”<br/>â€¢ onOrderCreated()<br/>â”â”â”â”â”â”â”<br/>å¤„ç†MQæ¶ˆæ¯"]
            
            Job["OrderSyncJob<br/>â”â”â”â”â”â”â”<br/>â€¢ syncOrders()<br/>â”â”â”â”â”â”â”<br/>å®šæ—¶ä»»åŠ¡è°ƒåº¦"]
        end
        
        AdapterPrinciple["âœ… éš”ç¦»å¤–éƒ¨åè®®<br/>âœ… ç»Ÿä¸€æ¥å…¥æ ‡å‡†<br/>âœ… å‚æ•°é¢„æ ¡éªŒ"]
    end

    %% ==========================================
    %% ç¬¬äºŒå±‚: Application (åº”ç”¨å±‚)
    %% ==========================================
    subgraph Layer2["âš™ï¸ Application Layer - åº”ç”¨å±‚"]
        direction LR
        style Layer2 fill:#fff3e0,stroke:#e65100,stroke-width:3px
        
        subgraph AppBox["èŒè´£: æµç¨‹ç¼–æ’ & ç”¨ä¾‹å®ç°"]
            AppService["UserApplicationService<br/>â”â”â”â”â”â”â”<br/>åº”ç”¨æœåŠ¡é—¨é¢"]
            
            RegisterUseCase["ç”¨ä¾‹: ç”¨æˆ·æ³¨å†Œ<br/>â”â”â”â”â”â”â”<br/>1ï¸âƒ£ è½¬æ¢DTOâ†’Domain<br/>2ï¸âƒ£ è°ƒç”¨é¢†åŸŸæœåŠ¡æ ¡éªŒ<br/>3ï¸âƒ£ ä¿å­˜èšåˆæ ¹<br/>4ï¸âƒ£ å‘é€æ¬¢è¿é‚®ä»¶<br/>5ï¸âƒ£ å‘å¸ƒé¢†åŸŸäº‹ä»¶<br/>6ï¸âƒ£ è½¬æ¢Domainâ†’DTO"]
            
            QueryUseCase["ç”¨ä¾‹: æŸ¥è¯¢ç”¨æˆ·<br/>â”â”â”â”â”â”â”<br/>1ï¸âƒ£ ä»ä»“å‚¨åŠ è½½<br/>2ï¸âƒ£ è½¬æ¢ä¸ºDTO<br/>3ï¸âƒ£ è¿”å›ç»“æœ"]
            
            Transaction["ğŸ”„ äº‹åŠ¡è¾¹ç•Œ<br/>@Transactional"]
        end
        
        AppPrinciple["âœ… æ— ä¸šåŠ¡é€»è¾‘<br/>âœ… ç¼–æ’Domainå¯¹è±¡<br/>âœ… æ§åˆ¶äº‹åŠ¡è¾¹ç•Œ"]
    end

    %% ==========================================
    %% ç¬¬ä¸‰å±‚: Domain (é¢†åŸŸå±‚) - æ ¸å¿ƒ
    %% ==========================================
    subgraph Layer3["ğŸ’ Domain Layer - é¢†åŸŸå±‚ â­æ ¸å¿ƒâ­"]
        direction LR
        style Layer3 fill:#e8f5e9,stroke:#1b5e20,stroke-width:4px
        
        subgraph DomainBox["èŒè´£: ä¸šåŠ¡è§„åˆ™ & æ ¸å¿ƒé€»è¾‘"]
            direction TB
            
            subgraph AggregateBox["èšåˆ (Aggregate)"]
                User["User èšåˆæ ¹<br/>â”â”â”â”â”â”â”<br/>ä¸šåŠ¡æ–¹æ³•:<br/>â€¢ register() æ³¨å†Œè§„åˆ™<br/>â€¢ activate() æ¿€æ´»é€»è¾‘<br/>â€¢ changeEmail() å˜æ›´è§„åˆ™<br/>â€¢ freeze() å†»ç»“é€»è¾‘<br/>â”â”â”â”â”â”â”<br/>åŒ…å«:<br/>â€¢ Email å€¼å¯¹è±¡<br/>â€¢ UserStatus æšä¸¾"]
            end
            
            subgraph ServiceBox["é¢†åŸŸæœåŠ¡"]
                DomainService["UserDomainService<br/>â”â”â”â”â”â”â”<br/>â€¢ checkDuplicateEmail()<br/>  æ£€æŸ¥é‚®ç®±å”¯ä¸€æ€§<br/>â€¢ encryptPassword()<br/>  å¯†ç åŠ å¯†è§„åˆ™<br/>â”â”â”â”â”â”â”<br/>è·¨èšåˆä¸šåŠ¡é€»è¾‘"]
            end
            
            subgraph InterfaceBox["ä»“å‚¨æ¥å£ (é˜²è…å±‚)"]
                IRepository["IUserRepository<br/>â”â”â”â”â”â”â”<br/>â€¢ save(user)<br/>â€¢ findById(id)<br/>â€¢ findByEmail(email)<br/>â”â”â”â”â”â”â”<br/>æ•°æ®è®¿é—®æŠ½è±¡"]
                
                IGateway["INotificationGateway<br/>â”â”â”â”â”â”â”<br/>â€¢ sendWelcomeEmail(user)<br/>â”â”â”â”â”â”â”<br/>ç¬¬ä¸‰æ–¹æœåŠ¡æŠ½è±¡"]
            end
        end
        
        DomainPrinciple["âœ… æ‰€æœ‰ä¸šåŠ¡è§„åˆ™åœ¨æ­¤<br/>âœ… å……è¡€æ¨¡å‹<br/>âœ… å®Œå…¨æŠ€æœ¯æ— å…³<br/>âœ… å®šä¹‰æ¥å£ä¸ä¾èµ–å®ç°"]
    end

    %% ==========================================
    %% ç¬¬å››å±‚: Infrastructure (åŸºç¡€è®¾æ–½å±‚)
    %% ==========================================
    subgraph Layer4["ğŸ”§ Infrastructure Layer - åŸºç¡€è®¾æ–½å±‚"]
        direction LR
        style Layer4 fill:#fce4ec,stroke:#880e4f,stroke-width:3px
        
        subgraph InfraBox["èŒè´£: æŠ€æœ¯å®ç° & å¤–éƒ¨é›†æˆ"]
            direction TB
            
            subgraph DBBox["æ•°æ®æŒä¹…åŒ–"]
                RepoImpl["UserRepositoryImpl<br/>â”â”â”â”â”â”â”<br/>å®ç° IUserRepository<br/>â”â”â”â”â”â”â”<br/>â€¢ MyBatisæ“ä½œ<br/>â€¢ Domain â†” POè½¬æ¢<br/>â€¢ ç¼“å­˜å¤„ç†"]
                
                DB[("ğŸ’¾ MySQLæ•°æ®åº“<br/>â”â”â”â”â”â”â”<br/>userè¡¨<br/>orderè¡¨")]
            end
            
            subgraph CacheBox["ç¼“å­˜"]
                Redis[("ğŸ”´ Redis<br/>â”â”â”â”â”â”â”<br/>ç”¨æˆ·ç¼“å­˜<br/>ä¼šè¯ä¿¡æ¯")]
            end
            
            subgraph ThirdPartyBox["ç¬¬ä¸‰æ–¹é›†æˆ"]
                NotificationImpl["NotificationGatewayImpl<br/>â”â”â”â”â”â”â”<br/>å®ç° INotificationGateway<br/>â”â”â”â”â”â”â”<br/>â€¢ è°ƒç”¨é‚®ä»¶æœåŠ¡<br/>â€¢ è°ƒç”¨çŸ­ä¿¡æœåŠ¡"]
                
                EmailService["ğŸ“§ ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡<br/>SendGrid/é˜¿é‡Œäº‘"]
                SMSService["ğŸ“± ç¬¬ä¸‰æ–¹çŸ­ä¿¡æœåŠ¡<br/>è…¾è®¯äº‘/é˜¿é‡Œäº‘"]
            end
            
            subgraph MQBox["æ¶ˆæ¯é˜Ÿåˆ—"]
                RabbitMQ["ğŸ° RabbitMQ<br/>â”â”â”â”â”â”â”<br/>å‘å¸ƒé¢†åŸŸäº‹ä»¶<br/>å¼‚æ­¥å¤„ç†"]
            end
        end
        
        InfraPrinciple["âœ… å®ç°Domainæ¥å£<br/>âœ… ä¾èµ–å€’ç½®åŸåˆ™<br/>âœ… å¯æ›¿æ¢æ€§"]
    end

    %% ==========================================
    %% Client API (å¯¹å¤–å¥‘çº¦)
    %% ==========================================
    subgraph ClientAPI["ğŸ“‹ Client API - å¯¹å¤–å¥‘çº¦"]
        style ClientAPI fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
        
        DTO["DTOå¯¹è±¡<br/>â”â”â”â”â”â”â”<br/>UserDTO<br/>OrderDTO<br/>â”â”â”â”â”â”â”<br/>æ•°æ®ä¼ è¾“"]
        
        Command["Commandå¯¹è±¡<br/>â”â”â”â”â”â”â”<br/>UserRegisterCmd<br/>OrderCreateCmd<br/>â”â”â”â”â”â”â”<br/>å†™æ“ä½œå‘½ä»¤"]
        
        Query["Queryå¯¹è±¡<br/>â”â”â”â”â”â”â”<br/>UserByIdQry<br/>OrderListQry<br/>â”â”â”â”â”â”â”<br/>è¯»æ“ä½œæŸ¥è¯¢"]
        
        CQRS["CQRSæ¨¡å¼<br/>è¯»å†™åˆ†ç¦»"]
    end

    %% ==========================================
    %% æ•°æ®æµè½¬ (è¯·æ±‚å¤„ç†å…¨æµç¨‹)
    %% ==========================================
    HTTP -->|1ï¸âƒ£ HTTPè¯·æ±‚| Controller
    MQ -->|1ï¸âƒ£ MQæ¶ˆæ¯| Listener
    Schedule -->|1ï¸âƒ£ å®šæ—¶è§¦å‘| Job
    
    Controller -->|2ï¸âƒ£ è°ƒç”¨æœåŠ¡<br/>ä¼ å…¥Command/Query| AppService
    Listener -->|2ï¸âƒ£ è°ƒç”¨æœåŠ¡| AppService
    Job -->|2ï¸âƒ£ è°ƒç”¨æœåŠ¡| AppService
    
    AppService -->|3ï¸âƒ£ æ‰§è¡Œç”¨ä¾‹| RegisterUseCase
    AppService -->|3ï¸âƒ£ æ‰§è¡Œç”¨ä¾‹| QueryUseCase
    
    RegisterUseCase -->|4ï¸âƒ£ è°ƒç”¨ä¸šåŠ¡è§„åˆ™| User
    RegisterUseCase -->|4ï¸âƒ£ è°ƒç”¨é¢†åŸŸæœåŠ¡| DomainService
    RegisterUseCase -->|5ï¸âƒ£ ä¾èµ–æ¥å£| IRepository
    RegisterUseCase -->|5ï¸âƒ£ ä¾èµ–æ¥å£| IGateway
    
    QueryUseCase -->|4ï¸âƒ£ ä¾èµ–æ¥å£| IRepository
    
    DomainService -->|ä¾èµ–æ¥å£| IRepository
    
    %% Infrastructureå®ç°æ¥å£ (ä¾èµ–å€’ç½®!)
    IRepository <-.->|6ï¸âƒ£ å®ç°| RepoImpl
    IGateway <-.->|6ï¸âƒ£ å®ç°| NotificationImpl
    
    RepoImpl -->|7ï¸âƒ£ æ•°æ®è®¿é—®| DB
    RepoImpl -->|7ï¸âƒ£ ç¼“å­˜| Redis
    NotificationImpl -->|7ï¸âƒ£ è°ƒç”¨| EmailService
    NotificationImpl -->|7ï¸âƒ£ è°ƒç”¨| SMSService
    RegisterUseCase -->|8ï¸âƒ£ å‘å¸ƒäº‹ä»¶| RabbitMQ
    
    %% DTOä½¿ç”¨å…³ç³»
    Controller -.->|ä½¿ç”¨| Command
    Controller -.->|ä½¿ç”¨| Query
    Controller -.->|è¿”å›| DTO
    AppService -.->|è¿”å›| DTO

    %% ==========================================
    %% å…³é”®è®¾è®¡åŸåˆ™è¯´æ˜æ¡†
    %% ==========================================
    subgraph Principles["ğŸ¯ DDDæ ¸å¿ƒè®¾è®¡åŸåˆ™"]
        style Principles fill:#ffebee,stroke:#b71c1c,stroke-width:3px
        
        P1["1ï¸âƒ£ ä¾èµ–å€’ç½® (DIP)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Domainå±‚å®šä¹‰æ¥å£<br/>â€¢ Infrastructureå±‚å®ç°æ¥å£<br/>â€¢ ä¾èµ–æ–¹å‘: Infra â†’ Domain<br/>â€¢ é«˜å±‚ä¸ä¾èµ–ä½å±‚ç»†èŠ‚"]
        
        P2["2ï¸âƒ£ å…³æ³¨ç‚¹åˆ†ç¦» (SoC)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Domain: What (ä¸šåŠ¡è§„åˆ™)<br/>â€¢ Application: When (æµç¨‹ç¼–æ’)<br/>â€¢ Infrastructure: How (æŠ€æœ¯å®ç°)<br/>â€¢ æ¯å±‚èŒè´£å•ä¸€æ¸…æ™°"]
        
        P3["3ï¸âƒ£ å……è¡€æ¨¡å‹ vs è´«è¡€æ¨¡å‹<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ User.register() âœ… å……è¡€<br/>â€¢ UserService.register(user) âŒ è´«è¡€<br/>â€¢ ä¸šåŠ¡é€»è¾‘åœ¨é¢†åŸŸå¯¹è±¡å†…"]
        
        P4["4ï¸âƒ£ é˜²è…å±‚ (ACL)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Gatewayæ¥å£éš”ç¦»ç¬¬ä¸‰æ–¹<br/>â€¢ Repositoryæ¥å£éš”ç¦»æ•°æ®åº“<br/>â€¢ ç¬¬ä¸‰æ–¹å˜æ›´ä¸å½±å“Domain"]
        
        P5["5ï¸âƒ£ èšåˆæ ¹ (Aggregate Root)<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Useræ˜¯èšåˆæ ¹<br/>â€¢ ç»Ÿä¸€å…¥å£ä¿®æ”¹èšåˆå†…å¯¹è±¡<br/>â€¢ ä¿è¯ä¸šåŠ¡ä¸€è‡´æ€§"]
    end

    %% ==========================================
    %% å®é™…é—®é¢˜è§£å†³æ–¹æ¡ˆ
    %% ==========================================
    subgraph Solutions["ğŸ’¡ è§£å†³çš„å®é™…é—®é¢˜"]
        style Solutions fill:#fff9c4,stroke:#f57f17,stroke-width:3px
        
        Problem1["âŒ ä¼ ç»Ÿåˆ†å±‚é—®é¢˜<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>Controller â†’ Service â†’ DAO<br/>â€¢ ä¸šåŠ¡é€»è¾‘æ•£è½åœ¨Service<br/>â€¢ è´«è¡€æ¨¡å‹,åªæœ‰get/set<br/>â€¢ ç´§è€¦åˆæ•°æ®åº“å®ç°"]
        
        Solution1["âœ… DDDè§£å†³æ–¹æ¡ˆ<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ ä¸šåŠ¡è§„åˆ™åœ¨Domainå¯¹è±¡<br/>â€¢ å……è¡€æ¨¡å‹,æœ‰è¡Œä¸ºæœ‰æ•°æ®<br/>â€¢ ä¾èµ–æ¥å£,æŠ€æœ¯æ— å…³"]
        
        Problem2["âŒ ä»£ç è…åŒ–é—®é¢˜<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ if-elseéå¸ƒService<br/>â€¢ ä¸šåŠ¡è§„åˆ™é‡å¤<br/>â€¢ ä¿®æ”¹ç‰µä¸€å‘åŠ¨å…¨èº«"]
        
        Solution2["âœ… DDDè§£å†³æ–¹æ¡ˆ<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ è§„åˆ™å°è£…åœ¨èšåˆå†…<br/>â€¢ å•ä¸€ä¿®æ”¹ç‚¹<br/>â€¢ é«˜å†…èšä½è€¦åˆ"]
        
        Problem3["âŒ ç¬¬ä¸‰æ–¹ä¾èµ–é—®é¢˜<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ ç›´æ¥è°ƒç”¨ç¬¬ä¸‰æ–¹API<br/>â€¢ æ›´æ¢æœåŠ¡æˆæœ¬é«˜<br/>â€¢ æµ‹è¯•å›°éš¾"]
        
        Solution3["âœ… DDDè§£å†³æ–¹æ¡ˆ<br/>â”â”â”â”â”â”â”â”â”â”â”â”â”â”<br/>â€¢ Gatewayé˜²è…å±‚éš”ç¦»<br/>â€¢ è½»æ¾åˆ‡æ¢å®ç°<br/>â€¢ Mockæ¥å£æ˜“æµ‹è¯•"]
    end

    %% å…³è”é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ
    Problem1 -.->|DDDæ”¹è¿›| Solution1
    Problem2 -.->|DDDæ”¹è¿›| Solution2
    Problem3 -.->|DDDæ”¹è¿›| Solution3

    %% ==========================================
    %% æ ·å¼å®šä¹‰
    %% ==========================================
    classDef externalStyle fill:#e0e0e0,stroke:#424242,stroke-width:2px
    classDef problemStyle fill:#ffcdd2,stroke:#c62828,stroke-width:2px
    classDef solutionStyle fill:#c8e6c9,stroke:#2e7d32,stroke-width:2px
    
    class HTTP,MQ,Schedule externalStyle
    class Problem1,Problem2,Problem3 problemStyle
    class Solution1,Solution2,Solution3 solutionStyle
