graph TB
    %% ==========================================
    %% è¯´æ˜æ¡†åŒºåŸŸ
    %% ==========================================
    subgraph Legend["ğŸ“Œ æ ¸å¿ƒè®¾è®¡åŸåˆ™"]
        DIP["ğŸ”· ä¾èµ–å€’ç½®åŸåˆ™<br/>é«˜å±‚æ¨¡å—(Domain/Application)åªä¾èµ–æ¥å£<br/>ä½å±‚æ¨¡å—(Infrastructure)å®ç°æ¥å£<br/>ä¾èµ–æ–¹å‘: Infrastructure â†’ Domain"]
        SoC["ğŸ”· å…³æ³¨ç‚¹åˆ†ç¦»<br/>Domainå±‚: What - ä¸šåŠ¡è§„åˆ™æ˜¯ä»€ä¹ˆ<br/>Applicationå±‚: When - ä½•æ—¶æ‰§è¡Œæµç¨‹<br/>Infrastructureå±‚: How - å¦‚ä½•æŠ€æœ¯å®ç°"]
        Flow["ğŸ”· è¯·æ±‚æµè½¬<br/>HTTPè¯·æ±‚ â†’ Adapter â†’ Application<br/>â†’ Domain â†’ Infrastructure"]
    end

    %% ==========================================
    %% Adapter Layer (é€‚é…å±‚)
    %% ==========================================
    subgraph Adapter["ğŸŒ Adapter Layer - é€‚é…å±‚"]
        direction TB
        AdapterNote["ã€èŒè´£ã€‘<br/>1. æ¥æ”¶å¤–éƒ¨è¯·æ±‚(HTTP/MQ/å®šæ—¶ä»»åŠ¡)<br/>2. åè®®è½¬æ¢å’Œå‚æ•°æ ¡éªŒ<br/>3. è°ƒç”¨Applicationå±‚"]
        
        Controller["UserController<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ register(request)<br/>+ getUserById(id)<br/>â”â”â”â”â”â”â”â”â”â”<br/>HTTPæ¥å£é€‚é…"]
        MQListener["OrderEventListener<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ onOrderCreated(msg)<br/>â”â”â”â”â”â”â”â”â”â”<br/>MQæ¶ˆæ¯é€‚é…"]
    end

    %% ==========================================
    %% Client Layer (APIå®šä¹‰å±‚)
    %% ==========================================
    subgraph Client["ğŸ“‹ Client Layer - å¯¹å¤–å¥‘çº¦"]
        direction TB
        ClientNote["ã€èŒè´£ã€‘<br/>1. å®šä¹‰å¯¹å¤–APIæ¥å£<br/>2. å®šä¹‰DTOå¯¹è±¡<br/>3. CQRSåˆ†ç¦»(Command/Query)"]
        
        ServiceI["ã€Šinterfaceã€‹<br/>UserServiceI<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ register(cmd): UserDTO<br/>+ queryById(qry): UserDTO"]
        
        RegCmd["UserRegisterCmd<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ username: String<br/>+ email: String<br/>+ password: String<br/>â”â”â”â”â”â”â”â”â”â”<br/>å‘½ä»¤å¯¹è±¡(å†™)"]
        
        QryObj["UserByIdQry<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ userId: Long<br/>â”â”â”â”â”â”â”â”â”â”<br/>æŸ¥è¯¢å¯¹è±¡(è¯»)"]
        
        DTO["UserDTO<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ id: Long<br/>+ username: String<br/>+ email: String<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ•°æ®ä¼ è¾“å¯¹è±¡"]
    end

    %% ==========================================
    %% Application Layer (åº”ç”¨å±‚)
    %% ==========================================
    subgraph Application["âš™ï¸ Application Layer - åº”ç”¨å±‚"]
        direction TB
        AppNote["ã€èŒè´£ã€‘<br/>1. ç¼–æ’ä¸šåŠ¡æµç¨‹(ä¸å«ä¸šåŠ¡é€»è¾‘)<br/>2. äº‹åŠ¡è¾¹ç•Œæ§åˆ¶<br/>3. DTOä¸é¢†åŸŸå¯¹è±¡è½¬æ¢<br/>4. è°ƒç”¨Domainå±‚å®Œæˆç”¨ä¾‹"]
        
        AppService["UserApplicationService<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ register(cmd): UserDTO<br/>+ queryById(qry): UserDTO<br/>â”â”â”â”â”â”â”â”â”â”<br/>åº”ç”¨æœåŠ¡é—¨é¢"]
        
        CmdExe["UserRegisterCmdExe<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ execute(cmd): UserDTO<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ‰§è¡Œæµç¨‹:<br/>1ï¸âƒ£ å‚æ•°æ ¡éªŒ<br/>2ï¸âƒ£ è°ƒç”¨é¢†åŸŸæœåŠ¡<br/>3ï¸âƒ£ ä¿å­˜åˆ°ä»“å‚¨<br/>4ï¸âƒ£ å‘é€é€šçŸ¥<br/>5ï¸âƒ£ è¿”å›DTO"]
        
        QryExe["UserByIdQryExe<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ execute(qry): UserDTO<br/>â”â”â”â”â”â”â”â”â”â”<br/>æŸ¥è¯¢æ‰§è¡Œå™¨"]
        
        Assembler["UserAssembler<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ toDTO(user): UserDTO<br/>+ toDO(cmd): User<br/>â”â”â”â”â”â”â”â”â”â”<br/>DTOè½¬æ¢å™¨"]
    end

    %% ==========================================
    %% Domain Layer (é¢†åŸŸå±‚) - æ ¸å¿ƒ
    %% ==========================================
    subgraph Domain["ğŸ’ Domain Layer - é¢†åŸŸå±‚ (æ ¸å¿ƒ)"]
        direction TB
        DomainNote["ã€èŒè´£ - ç³»ç»Ÿæ ¸å¿ƒä»·å€¼ã€‘<br/>1. å°è£…æ‰€æœ‰ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘<br/>2. å®Œå…¨ç‹¬ç«‹,ä¸ä¾èµ–ä»»ä½•æŠ€æœ¯å®ç°<br/>3. å®šä¹‰ä»“å‚¨å’Œç½‘å…³æ¥å£<br/>4. ä½¿ç”¨å……è¡€æ¨¡å‹(è¡Œä¸º+æ•°æ®)"]
        
        UserEntity["ã€ŠAggregateRootã€‹<br/>User<br/>â”â”â”â”â”â”â”â”â”â”<br/>- id: Long<br/>- email: Email<br/>- status: UserStatus<br/>- password: String<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ register() æ³¨å†Œè§„åˆ™<br/>+ activate() æ¿€æ´»<br/>+ changeEmail() é‚®ç®±å˜æ›´<br/>+ validatePassword() å¯†ç æ ¡éªŒ<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ èšåˆæ ¹: ä¸šåŠ¡é€»è¾‘è½½ä½“"]
        
        EmailVO["ã€ŠValueObjectã€‹<br/>Email<br/>â”â”â”â”â”â”â”â”â”â”<br/>- value: String<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ validate() æ ¼å¼éªŒè¯<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ å€¼å¯¹è±¡: ä¸å¯å˜"]
        
        StatusEnum["ã€Šenumerationã€‹<br/>UserStatus<br/>â”â”â”â”â”â”â”â”â”â”<br/>INACTIVE æœªæ¿€æ´»<br/>ACTIVE æ­£å¸¸<br/>FROZEN å†»ç»“"]
        
        DomainService["UserDomainService<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ checkDuplicateEmail()<br/>+ encryptPassword()<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ é¢†åŸŸæœåŠ¡<br/>åœºæ™¯: è·¨èšåˆä¸šåŠ¡é€»è¾‘"]
        
        IRepo["ã€Šinterfaceã€‹<br/>IUserRepository<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ save(user): User<br/>+ findById(id): User<br/>+ findByEmail(): User<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ ä»“å‚¨æ¥å£<br/>åœ¨Domainå±‚å®šä¹‰"]
        
        IGateway["ã€Šinterfaceã€‹<br/>INotificationGateway<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ sendWelcomeEmail(user)<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ é˜²è…å±‚æ¥å£<br/>éš”ç¦»ç¬¬ä¸‰æ–¹ä¾èµ–"]
    end

    %% ==========================================
    %% Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)
    %% ==========================================
    subgraph Infrastructure["ğŸ”§ Infrastructure Layer - åŸºç¡€è®¾æ–½å±‚"]
        direction TB
        InfraNote["ã€èŒè´£ã€‘<br/>1. å®ç°Domainå±‚å®šä¹‰çš„æ¥å£<br/>2. å¤„ç†æŠ€æœ¯ç»†èŠ‚(DB/ç¼“å­˜/MQ)<br/>3. ä¾èµ–å€’ç½®: ä¾èµ–Domainå±‚<br/>4. æ•°æ®åº“å®ä½“ä¸é¢†åŸŸå¯¹è±¡è½¬æ¢"]
        
        RepoImpl["UserRepositoryImpl<br/>â”â”â”â”â”â”â”â”â”â”<br/>- mapper: UserMapper<br/>- converter: UserConverter<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ save(user): User<br/>+ findById(id): User<br/>â”â”â”â”â”â”â”â”â”â”<br/>MyBatiså®ç°ä»“å‚¨"]
        
        Mapper["ã€ŠMyBatisã€‹<br/>UserMapper<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ insert(po): void<br/>+ selectById(id): UserPO<br/>+ update(po): void<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ•°æ®åº“æ“ä½œ"]
        
        PO["UserPO<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ id: Long<br/>+ email: String<br/>+ status: String<br/>+ password: String<br/>â”â”â”â”â”â”â”â”â”â”<br/>æŒä¹…åŒ–å¯¹è±¡<br/>å¯¹åº”æ•°æ®åº“è¡¨"]
        
        Converter["UserConverter<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ toPO(user): UserPO<br/>+ toDO(po): User<br/>â”â”â”â”â”â”â”â”â”â”<br/>é¢†åŸŸå¯¹è±¡â†”POè½¬æ¢"]
        
        GatewayImpl["NotificationGatewayImpl<br/>â”â”â”â”â”â”â”â”â”â”<br/>- emailClient: EmailClient<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ sendWelcomeEmail(user)<br/>â”â”â”â”â”â”â”â”â”â”<br/>é€šçŸ¥ç½‘å…³å®ç°"]
        
        ThirdParty["EmailClient<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ send(to, subject, body)<br/>â”â”â”â”â”â”â”â”â”â”<br/>ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡"]
    end

    %% ==========================================
    %% ä¾èµ–å…³ç³» (é‡ç‚¹: ä½“ç°ä¾èµ–å€’ç½®)
    %% ==========================================
    
    %% Adapter -> Application
    Controller -->|è°ƒç”¨| AppService
    Controller -.->|ä½¿ç”¨| RegCmd
    Controller -.->|è¿”å›| DTO
    
    %% Application -> Domain
    AppService -->|å§”æ‰˜| CmdExe
    AppService -->|å§”æ‰˜| QryExe
    CmdExe -->|ä½¿ç”¨| DomainService
    CmdExe -->|ä¾èµ–æ¥å£| IRepo
    CmdExe -->|ä¾èµ–æ¥å£| IGateway
    CmdExe -->|è½¬æ¢| Assembler
    Assembler -.->|ç”Ÿæˆ| UserEntity
    
    %% Domainå†…éƒ¨
    UserEntity -->|åŒ…å«| EmailVO
    UserEntity -->|åŒ…å«| StatusEnum
    DomainService -->|ä¾èµ–æ¥å£| IRepo
    
    %% Infrastructure -> Domain (ä¾èµ–å€’ç½®çš„å…³é”®!)
    RepoImpl -.->|å®ç°| IRepo
    GatewayImpl -.->|å®ç°| IGateway
    RepoImpl -->|ä½¿ç”¨| Mapper
    RepoImpl -->|ä½¿ç”¨| Converter
    Mapper -->|æ“ä½œ| PO
    Converter -->|è½¬æ¢| PO
    Converter -->|è½¬æ¢| UserEntity
    GatewayImpl -->|è°ƒç”¨| ThirdParty

    %% ==========================================
    %% æ ·å¼å®šä¹‰
    %% ==========================================
    classDef adapterStyle fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef clientStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef appStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef domainStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px
    classDef infraStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef noteStyle fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef legendStyle fill:#ffebee,stroke:#b71c1c,stroke-width:2px
    
    class Controller,MQListener,AdapterNote adapterStyle
    class ServiceI,RegCmd,QryObj,DTO,ClientNote clientStyle
    class AppService,CmdExe,QryExe,Assembler,AppNote appStyle
    class UserEntity,EmailVO,StatusEnum,DomainService,IRepo,IGateway,DomainNote domainStyle
    class RepoImpl,Mapper,PO,Converter,GatewayImpl,ThirdParty,InfraNote infraStyle
    class DIP,SoC,Flow legendStyle