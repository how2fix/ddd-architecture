graph TB
    %% ==========================================
    %% è¯´æ˜æ¡†åŒºåŸŸ
    %% ==========================================
    subgraph Legend["ğŸ“Œ æ ¸å¿ƒè®¾è®¡åŸåˆ™ v2.0"]
        DIP["ğŸ”· ä¾èµ–å€’ç½®åŸåˆ™ DIP<br/>â”â”â”â”â”â”â”â”â”â”<br/>Domainå±‚å®šä¹‰æ¥å£(IUserRepository/IEmailGateway)<br/>Infrastructureå±‚å®ç°æ¥å£<br/>ä¾èµ–æ–¹å‘: Infrastructure â†’ Domain"]
        SoC["ğŸ”· å…³æ³¨ç‚¹åˆ†ç¦»<br/>â”â”â”â”â”â”â”â”â”â”<br/>Domainå±‚: What - ä¸šåŠ¡è§„åˆ™æ˜¯ä»€ä¹ˆ<br/>Applicationå±‚: When - ä½•æ—¶æ‰§è¡Œæµç¨‹<br/>Infrastructureå±‚: How - å¦‚ä½•æŠ€æœ¯å®ç°"]
        Flow["ğŸ”· è¯·æ±‚æµè½¬<br/>â”â”â”â”â”â”â”â”â”â”<br/>HTTP â†’ UserController â†’ UserServiceI<br/>â†’ UserApplicationService â†’ UserRegisterCmdExe<br/>â†’ User(èšåˆæ ¹) + UserDomainService<br/>â†’ UserRepositoryImpl â†’ H2 Database"]
        Extension["ğŸ”· æ‰©å±•ç‚¹æœºåˆ¶<br/>â”â”â”â”â”â”â”â”â”â”<br/>@Extension(bizId) æ³¨è§£æ ‡è®°<br/>ExtensionExecutor è·¯ç”±æ‰§è¡Œ<br/>æ”¯æŒå¤šä¸šåŠ¡åœºæ™¯: DEFAULT/VIP/Enterprise"]
    end

    %% ==========================================
    %% Adapter Layer (é€‚é…å±‚)
    %% ==========================================
    subgraph Adapter["ğŸŒ Adapter Layer - é€‚é…å±‚"]
        direction TB
        style Adapter fill:#e1f5ff,stroke:#01579b,stroke-width:3px

        AdapterNote["ã€èŒè´£ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>1. æ¥æ”¶å¤–éƒ¨è¯·æ±‚(HTTP/MQ/å®šæ—¶ä»»åŠ¡)<br/>2. åè®®è½¬æ¢å’Œå‚æ•°æ ¡éªŒ(@Valid)<br/>3. è°ƒç”¨Applicationå±‚<br/>4. è–„è–„ä¸€å±‚,æ— ä¸šåŠ¡é€»è¾‘"]

        subgraph AdapterModule["ğŸ“ user-adapter æ¨¡å—"]
            Controller["UserController<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: adapter/web/UserController.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ register(@Valid cmd): Response<br/>+ getById(@PathVariable id): Response<br/>+ health(): Response<br/>â”â”â”â”â”â”â”â”â”â”<br/>HTTPæ¥å£é€‚é…"]

            GlobalExcep["GlobalExceptionHandler<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: adapter/exception/GlobalExceptionHandler.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ handleBizException(e): Response<br/>+ handleValidationException(e): Response<br/>â”â”â”â”â”â”â”â”â”â”<br/>ç»Ÿä¸€å¼‚å¸¸å¤„ç†"]
        end

        AdapterBox["ã€é›†æˆç‚¹ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client<br/>è°ƒç”¨: UserServiceI"]
    end

    %% ==========================================
    %% Client Layer (APIå®šä¹‰å±‚)
    %% ==========================================
    subgraph Client["ğŸ“‹ Client Layer - å¯¹å¤–å¥‘çº¦"]
        direction TB
        style Client fill:#f3e5f5,stroke:#4a148c,stroke-width:2px

        ClientNote["ã€èŒè´£ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>1. å®šä¹‰å¯¹å¤–APIæ¥å£<br/>2. å®šä¹‰DTO/Command/Queryå¯¹è±¡<br/>3. CQRSåˆ†ç¦»(è¯»å†™åˆ†ç¦»)<br/>4. å®šä¹‰å¼‚å¸¸ä½“ç³»"]

        subgraph ClientModule["ğŸ“ user-client æ¨¡å—"]
            ClientAPI["ã€Šinterfaceã€‹<br/>UserServiceI<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: api/UserServiceI.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ register(cmd): Response<br/>+ getById(qry): Response"]

            ClientDTO["UserDTO<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: dto/UserDTO.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ id: Long<br/>+ username: String<br/>+ email: String(è„±æ•)<br/>+ phone: String(è„±æ•)<br/>+ status: UserStatus<br/>+ registerTime: LocalDateTime"]

            ClientCmd["UserRegisterCmd<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: dto/cmd/UserRegisterCmd.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ username: String<br/>+ email: String<br/>+ password: String<br/>+ phone: String<br/>+ sendEmail: Boolean<br/>+ sendSms: Boolean<br/>â”â”â”â”â”â”â”â”â”â”<br/>å†™æ“ä½œå‘½ä»¤(Command)"]

            ClientQry["UserByIdQry<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: dto/query/UserByIdQry.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ userId: Long<br/>â”â”â”â”â”â”â”â”â”â”<br/>è¯»æ“ä½œæŸ¥è¯¢(Query)"]

            ClientResp["Response~T~<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: dto/Response.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ success: boolean<br/>+ errCode: String<br/>+ errMessage: String<br/>+ data: T"]

            ClientExc["BizException / SysException<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: exception/*.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>BizException: å¯é¢„æœŸä¸šåŠ¡å¼‚å¸¸<br/>SysException: ä¸å¯é¢„æœŸç³»ç»Ÿå¼‚å¸¸<br/>ErrorCode: é”™è¯¯ç æšä¸¾"]
        end

        ClientBox["ã€ä¾èµ–å…³ç³»ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>è¢«æ‰€æœ‰å±‚ä¾èµ–<br/>æœ€åº•å±‚æ¨¡å—"]
    end

    %% ==========================================
    %% Application Layer (åº”ç”¨å±‚)
    %% ==========================================
    subgraph Application["âš™ï¸ Application Layer - åº”ç”¨å±‚"]
        direction TB
        style Application fill:#fff3e0,stroke:#e65100,stroke-width:3px

        AppNote["ã€èŒè´£ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>1. ç¼–æ’ä¸šåŠ¡æµç¨‹(ä¸å«ä¸šåŠ¡é€»è¾‘)<br/>2. äº‹åŠ¡è¾¹ç•Œæ§åˆ¶(@Transactional)<br/>3. DTOä¸é¢†åŸŸå¯¹è±¡è½¬æ¢<br/>4. è°ƒç”¨Domainå±‚å®Œæˆç”¨ä¾‹"]

        subgraph AppModule["ğŸ“ user-app æ¨¡å—"]
            AppService["UserApplicationService<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: app/UserApplicationService.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ register(cmd): Response<br/>+ getById(qry): Response<br/>â”â”â”â”â”â”â”â”â”â”<br/>åº”ç”¨æœåŠ¡é—¨é¢"]

            AppCmdExe["UserRegisterCmdExe<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: app/executor/UserRegisterCmdExe.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>@Transactional<br/>+ execute(cmd): Response<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ‰§è¡Œæµç¨‹:<br/>1ï¸âƒ£ validate(cmd) å‚æ•°æ ¡éªŒ<br/>2ï¸âƒ£ buildUser(cmd) æ„å»ºé¢†åŸŸå¯¹è±¡<br/>3ï¸âƒ£ user.register() ä¸šåŠ¡é€»è¾‘<br/>4ï¸âƒ£ userRepository.save() æŒä¹…åŒ–<br/>5ï¸âƒ£ sendNotifications() å‘é€é€šçŸ¥"]

            AppCmdExeExt["UserRegisterCmdExeWithExtension<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: app/executor/UserRegisterCmdExeWithExtension.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>@Transactional<br/>+ execute(cmd, bizScenario): Response<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ”¯æŒæ‰©å±•ç‚¹çš„æ³¨å†Œæ‰§è¡Œå™¨"]

            AppQryExe["UserByIdQryExe<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: app/executor/UserByIdQryExe.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ execute(qry): Response<br/>â”â”â”â”â”â”â”â”â”â”<br/>æŸ¥è¯¢æ‰§è¡Œå™¨"]

            AppAssem["UserAssembler<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: app/assembler/UserAssembler.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ toDTO(user): UserDTO<br/>+ toFullDTO(user): UserDTO<br/>+ toDomain(cmd): User<br/>+ toDTOList(users): List<br/>+ getMaskedPhone(): String<br/>+ getMaskedEmail(): String<br/>â”â”â”â”â”â”â”â”â”â”<br/>DTOè½¬æ¢å™¨(å«æ•°æ®è„±æ•)"]
        end

        AppBox["ã€ä¾èµ–å…³ç³»ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client, user-domain<br/>è¢«: user-adapter ä¾èµ–"]
    end

    %% ==========================================
    %% Domain Layer (é¢†åŸŸå±‚) - æ ¸å¿ƒ
    %% ==========================================
    subgraph Domain["ğŸ’ Domain Layer - é¢†åŸŸå±‚ (æ ¸å¿ƒ)"]
        direction TB
        style Domain fill:#e8f5e9,stroke:#1b5e20,stroke-width:4px

        DomainNote["ã€èŒè´£ - ç³»ç»Ÿæ ¸å¿ƒä»·å€¼ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>1. å°è£…æ‰€æœ‰ä¸šåŠ¡è§„åˆ™å’Œé€»è¾‘<br/>2. å®Œå…¨ç‹¬ç«‹,ä¸ä¾èµ–ä»»ä½•æŠ€æœ¯å®ç°<br/>3. å®šä¹‰ä»“å‚¨å’Œç½‘å…³æ¥å£<br/>4. ä½¿ç”¨å……è¡€æ¨¡å‹(è¡Œä¸º+æ•°æ®)<br/>5. æ”¯æŒæ‰©å±•ç‚¹æœºåˆ¶"]

        subgraph DomainModule["ğŸ“ user-domain æ¨¡å—"]

            subgraph Aggregate["èšåˆ (Aggregate)"]
                UserEntity["ã€ŠAggregateRootã€‹<br/>User<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/model/User.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>å­—æ®µ:<br/>- id: Long<br/>- username: String<br/>- email: Email(å€¼å¯¹è±¡)<br/>- phone: Phone(å€¼å¯¹è±¡)<br/>- password: String<br/>- status: UserStatus<br/>- registerTime: LocalDateTime<br/>- lastActiveTime: LocalDateTime<br/>â”â”â”â”â”â”â”â”â”â”<br/>ä¸šåŠ¡æ–¹æ³•:<br/>+ register(encryptedPwd): void<br/>+ activate(): void<br/>+ freeze(): void<br/>+ changeEmail(newEmail): void<br/>+ canActivate(): boolean<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ èšåˆæ ¹: ä¸šåŠ¡é€»è¾‘è½½ä½“"]
            end

            subgraph ValueObjects["å€¼å¯¹è±¡ (ValueObject)"]
                EmailVO["ã€ŠValueObjectã€‹<br/>Email<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/model/Email.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>- EMAIL_PATTERN: Pattern<br/>- value: String<br/>+ Email(value): æ„é€ æ—¶æ ¡éªŒ<br/>+ isValid(value): boolean<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ å€¼å¯¹è±¡: ä¸å¯å˜,è‡ªéªŒè¯"]

                PhoneVO["ã€ŠValueObjectã€‹<br/>Phone<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/model/Phone.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>- PHONE_PATTERN: Pattern<br/>- value: String<br/>+ Phone(value): æ„é€ æ—¶æ ¡éªŒ<br/>+ isValid(value): boolean"]
            end

            subgraph Enums["æšä¸¾"]
                StatusEnum["ã€Šenumerationã€‹<br/>UserStatus<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: client/constant/UserStatus.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>INACTIVE æœªæ¿€æ´»<br/>ACTIVE æ­£å¸¸<br/>FROZEN å†»ç»“"]
            end

            subgraph DomainServices["é¢†åŸŸæœåŠ¡ (DomainService)"]
                DomainSvc["UserDomainService<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/service/UserDomainService.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ isEmailExists(email): boolean<br/>+ isPhoneExists(phone): boolean<br/>+ isUsernameExists(username): boolean<br/>+ encryptPassword(plainPwd): String<br/>+ verifyPassword(plain, enc): boolean<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ é¢†åŸŸæœåŠ¡<br/>åœºæ™¯: è·¨èšåˆä¸šåŠ¡é€»è¾‘<br/>æŠ€æœ¯ä¾èµ–: BCryptåŠ å¯†"]
            end

            subgraph Repositories["ä»“å‚¨æ¥å£ (Repository)"]
                IRepo["ã€Šinterfaceã€‹<br/>IUserRepository<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/gateway/IUserRepository.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ save(user): User<br/>+ findById(id): User<br/>+ findByEmail(email): User<br/>+ findByPhone(phone): User<br/>+ findByUsername(username): User<br/>+ update(user): User<br/>+ delete(id): void<br/>â”â”â”â”â”â”â”â”â”â”<br/>ğŸ”‘ ä»“å‚¨æ¥å£<br/>åœ¨Domainå±‚å®šä¹‰,Infrastructureå±‚å®ç°"]
            end

            subgraph Gateways["ç½‘å…³æ¥å£ (Gateway/é˜²è…å±‚)"]
                IEmailGW["ã€Šinterfaceã€‹<br/>IEmailGateway<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/gateway/IEmailGateway.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ sendWelcomeEmail(to, username): boolean<br/>+ sendVerifyEmail(to, code): boolean"]

                ISmsGW["ã€Šinterfaceã€‹<br/>ISmsGateway<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/gateway/ISmsGateway.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ sendRegisterSms(to, username): boolean<br/>+ sendVerifyCode(to, code): boolean"]
            end

            subgraph Extensions["æ‰©å±•ç‚¹æœºåˆ¶"]
                ExtPtI["ã€Šinterfaceã€‹<br/>ExtensionPointI<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/extension/ExtensionPointI.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ‰©å±•ç‚¹æ ‡è®°æ¥å£"]

                ExtExec["ExtensionExecutor<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/extension/ExtensionExecutor.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ execute(extPt, scenario, invoker): R<br/>+ executeVoid(extPt, scenario, invoker): void<br/>+ getExtension(extPt, scenario): T<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ‰©å±•ç‚¹æ‰§è¡Œå™¨,æ ¹æ®åœºæ™¯è·¯ç”±"]

                ExtBiz["BizScenario<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/extension/BizScenario.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ valueOf(bizId): BizScenario<br/>+ valueOf(bizId, useCase): BizScenario<br/>+ matches(bizId, useCase, scenario): boolean<br/>â”â”â”â”â”â”â”â”â”â”<br/>ä¸šåŠ¡åœºæ™¯æ ‡è¯†"]

                ExtAnn["@Extension<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: domain/extension/Extension.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ bizId: ä¸šåŠ¡èº«ä»½<br/>+ useCase: ç”¨ä¾‹<br/>+ scenario: åœºæ™¯<br/>+ description: æè¿°"]

                ExtList["å·²å®ç°çš„æ‰©å±•ç‚¹:<br/>â”â”â”â”â”â”â”â”â”â”<br/>â€¢ UserValidatorExtPt<br/>  â†’ Default/Vipå®ç°<br/>â€¢ UserRegisterBonusExtPt<br/>  â†’ Default/Vipå®ç°<br/>â€¢ LevelUpgradeExtPt<br/>  â†’ Normal/Vip/Enterprise<br/>â€¢ RiskCheckExtPt<br/>  â†’ Register/Payment/Withdraw/Login<br/>â€¢ PointCalculateExtPt<br/>  â†’ Purchase/VipPurchase/Checkin/Comment<br/>â€¢ NotificationChannelExtPt<br/>  â†’ Default/Vip/Enterprise<br/>â€¢ OrderDiscountExtPt<br/>  â†’ NewUser/Default/Vip/Enterprise<br/>â€¢ RegisterValidatorExtPt<br/>  â†’ Email/Phone/Enterprise/Wechat"]
            end
        end

        DomainBox["ã€ä¾èµ–å…³ç³»ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client<br/>è¢«: user-app, user-infrastructure ä¾èµ–"]
    end

    %% ==========================================
    %% Infrastructure Layer (åŸºç¡€è®¾æ–½å±‚)
    %% ==========================================
    subgraph Infrastructure["ğŸ”§ Infrastructure Layer - åŸºç¡€è®¾æ–½å±‚"]
        direction TB
        style Infrastructure fill:#fce4ec,stroke:#880e4f,stroke-width:3px

        InfraNote["ã€èŒè´£ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>1. å®ç°Domainå±‚å®šä¹‰çš„æ¥å£<br/>2. å¤„ç†æŠ€æœ¯ç»†èŠ‚(DB/ç¼“å­˜/MQ/ç¬¬ä¸‰æ–¹)<br/>3. ä¾èµ–å€’ç½®: ä¾èµ–Domainå±‚æ¥å£<br/>4. æ•°æ®åº“å®ä½“ä¸é¢†åŸŸå¯¹è±¡è½¬æ¢"]

        subgraph InfraModule["ğŸ“ user-infrastructure æ¨¡å—"]

            subgraph Persistence["æ•°æ®æŒä¹…åŒ–"]
                RepoImpl["UserRepositoryImpl<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: infrastructure/gatewayimpl/UserRepositoryImpl.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>- userMapper: UserMapper<br/>- userConverter: UserConverter<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ save(user): User<br/>+ findById(id): User<br/>+ findByEmail/Phone/Username(): User<br/>â”â”â”â”â”â”â”â”â”â”<br/>MyBatiså®ç°ä»“å‚¨"]

                Mapper["ã€ŠMyBatisã€‹<br/>UserMapper<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: infrastructure/mapper/UserMapper.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ insert(po): int<br/>+ selectById(id): UserPO<br/>+ updateById(po): int<br/>+ deleteById(id): int"]

                PO["UserPO<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: infrastructure/dataobject/UserPO.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>@TableName('user')<br/>+ id: Long<br/>+ username: String<br/>+ email: String<br/>+ phone: String<br/>+ password: String<br/>+ status: String<br/>+ registerTime: LocalDateTime<br/>â”â”â”â”â”â”â”â”â”â”<br/>æŒä¹…åŒ–å¯¹è±¡,å¯¹åº”æ•°æ®åº“è¡¨"]

                Converter["UserConverter<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: infrastructure/converter/UserConverter.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ toDataObject(user): UserPO<br/>+ toDomain(po): User<br/>â”â”â”â”â”â”â”â”â”â”<br/>é¢†åŸŸå¯¹è±¡ â†” POè½¬æ¢<br/>å¤„ç†Email/Phoneå€¼å¯¹è±¡"]
            end

            subgraph GatewaysImpl["ç½‘å…³å®ç°"]
                EmailGWImpl["EmailGatewayImpl<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: infrastructure/gatewayimpl/EmailGatewayImpl.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ sendWelcomeEmail(to, username): boolean<br/>+ sendVerifyEmail(to, code): boolean<br/>â”â”â”â”â”â”â”â”â”â”<br/>é˜²è…å±‚,æ—¥å¿—è®°å½•,æ¨¡æ‹Ÿå‘é€"]

                SmsGWImpl["SmsGatewayImpl<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: infrastructure/gatewayimpl/SmsGatewayImpl.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>+ sendRegisterSms(to, username): boolean<br/>+ sendVerifyCode(to, code): boolean"]
            end

            subgraph External["å¤–éƒ¨æœåŠ¡(é¢„ç•™)"]
                ThirdPartyEmail["ğŸ“§ ç¬¬ä¸‰æ–¹é‚®ä»¶æœåŠ¡<br/>(å®é™…é¡¹ç›®å¯¹æ¥)<br/>SendGrid/é˜¿é‡Œäº‘/è…¾è®¯äº‘"]

                ThirdPartySms["ğŸ“± ç¬¬ä¸‰æ–¹çŸ­ä¿¡æœåŠ¡<br/>(å®é™…é¡¹ç›®å¯¹æ¥)<br/>é˜¿é‡Œäº‘/è…¾è®¯äº‘"]

                Database["ğŸ’¾ H2 Database<br/>â”â”â”â”â”â”â”â”â”â”<br/>å¼€å‘ç¯å¢ƒå†…å­˜æ•°æ®åº“<br/>ç”Ÿäº§ç¯å¢ƒæ›¿æ¢ä¸ºMySQL"]
            end
        end

        InfraBox["ã€ä¾èµ–å…³ç³»ã€‘<br/>â”â”â”â”â”â”â”â”â”â”<br/>ä¾èµ–: user-client, user-domain<br/>è¢«: user-app ä¾èµ–"]
    end

    %% ==========================================
    %% å¯åŠ¨æ¨¡å—
    %% ==========================================
    subgraph StartModule["ğŸš€ user-start æ¨¡å—"]
        direction TB
        style StartModule fill:#e0f2f1,stroke:#00695c,stroke-width:2px

        StartApp["UserApplication<br/>â”â”â”â”â”â”â”â”â”â”<br/>æ–‡ä»¶: UserApplication.java<br/>â”â”â”â”â”â”â”â”â”â”<br/>@SpringBootApplication<br/>+ main(args): void<br/>â”â”â”â”â”â”â”â”â”â”<br/>Spring Bootå¯åŠ¨å…¥å£"]

        StartConfig["é…ç½®ç±»<br/>â”â”â”â”â”â”â”â”â”â”<br/>application.yml<br/>- port: 8080<br/>- h2: mem:user_db"]
    end

    %% ==========================================
    %% ä¾èµ–å…³ç³» (é‡ç‚¹: ä½“ç°ä¾èµ–å€’ç½®)
    %% ==========================================

    %% å¯åŠ¨æ¨¡å—
    StartModule -->|å¯åŠ¨| Adapter
    StartModule -->|æ‰«æ| Application
    StartModule -->|æ‰«æ| Infrastructure

    %% Adapter -> Application
    Controller -->|è°ƒç”¨| AppService
    Controller -.->|ä½¿ç”¨| ClientCmd
    Controller -.->|è¿”å›| ClientResp
    GlobalExcep -->|æ•è·| ClientExc

    %% Application -> Domain
    AppService -->|å§”æ‰˜| AppCmdExe
    AppService -->|å§”æ‰˜| AppQryExe
    AppCmdExe -->|ä½¿ç”¨| UserEntity
    AppCmdExe -->|ä½¿ç”¨| DomainSvc
    AppCmdExe -->|ä¾èµ–æ¥å£| IRepo
    AppCmdExe -->|ä¾èµ–æ¥å£| IEmailGW
    AppCmdExe -->|ä¾èµ–æ¥å£| ISmsGW
    AppCmdExe -->|è½¬æ¢| AppAssem
    AppAssem -.->|ç”Ÿæˆ| UserEntity

    AppCmdExeExt -->|ä½¿ç”¨| ExtExec
    AppCmdExeExt -->|ä½¿ç”¨åœºæ™¯| ExtBiz
    ExtExec -.->|æŸ¥æ‰¾å®ç°| ExtList

    AppQryExe -->|ä¾èµ–æ¥å£| IRepo
    AppQryExe -->|è½¬æ¢| AppAssem

    %% Domainå†…éƒ¨
    UserEntity -->|åŒ…å«| EmailVO
    UserEntity -->|åŒ…å«| PhoneVO
    UserEntity -->|åŒ…å«| StatusEnum
    DomainSvc -->|ä¾èµ–æ¥å£| IRepo

    %% Infrastructure -> Domain (ä¾èµ–å€’ç½®çš„å…³é”®!)
    RepoImpl -.->|å®ç°| IRepo
    EmailGWImpl -.->|å®ç°| IEmailGW
    SmsGWImpl -.->|å®ç°| ISmsGW
    RepoImpl -->|ä½¿ç”¨| Mapper
    RepoImpl -->|ä½¿ç”¨| Converter
    Mapper -->|æ“ä½œ| PO
    Converter -->|è½¬æ¢| PO
    Converter -->|è½¬æ¢| UserEntity
    EmailGWImpl -.->|è°ƒç”¨| ThirdPartyEmail
    SmsGWImpl -.->|è°ƒç”¨| ThirdPartySms
    Mapper -->|æ“ä½œ| Database

    %% ==========================================
    %% æ ·å¼å®šä¹‰
    %% ==========================================
    classDef adapterStyle fill:#e1f5ff,stroke:#01579b,stroke-width:2px
    classDef clientStyle fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef appStyle fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef domainStyle fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px
    classDef infraStyle fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef noteStyle fill:#fff9c4,stroke:#f57f17,stroke-width:2px
    classDef legendStyle fill:#ffebee,stroke:#b71c1c,stroke-width:2px
    classDef moduleStyle fill:#f5f5f5,stroke:#616161,stroke-width:2px,stroke-dasharray: 5 5

    class Controller,GlobalExcep adapterStyle
    class ClientAPI,ClientDTO,ClientCmd,ClientQry,ClientResp,ClientExc clientStyle
    class AppService,AppCmdExe,AppCmdExeExt,AppQryExe,AppAssem appStyle
    class UserEntity,EmailVO,PhoneVO,StatusEnum,DomainSvc,IRepo,IEmailGW,ISmsGW,ExtPtI,ExtExec,ExtBiz,ExtAnn domainStyle
    class RepoImpl,Mapper,PO,Converter,EmailGWImpl,SmsGWImpl,ThirdPartyEmail,ThirdPartySms,Database infraStyle
    class AdapterNote,ClientNote,AppNote,DomainNote,InfraNote,AdapterBox,ClientBox,AppBox,DomainBox,InfraBox,ExtList noteStyle
    class DIP,SoC,Flow,Extension legendStyle
